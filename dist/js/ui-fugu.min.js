/*
 * angular-ui-fugu
 * Version: 0.0.1 - 2016-01-25
 * License: ISC
 */
angular.module("ui.fugu",["ui.fugu.tpls","ui.fugu.alert","ui.fugu.button","ui.fugu.buttonGroup","ui.fugu.dropdown","ui.fugu.pager","ui.fugu.searchBox","ui.fugu.tree"]),angular.module("ui.fugu.tpls",["alert/templates/alert.html","button/templates/button.html","buttonGroup/templates/buttonGroup.html","dropdown/templates/dropdown-choices.html","dropdown/templates/dropdown.html","pager/templates/pager.html","searchBox/templates/searchBox.html"]),angular.module("ui.fugu.alert",[]).controller("fuguAlertCtrl",["$scope","$attrs","$timeout","$interpolate",function(e,t,n,a){function l(){!e.close||"true"!=e.close&&"1"!=e.close?e.closeable=!1:e.closeable=!0,e.defaultclose=!1,e.hasIcon=t.hasIcon&&"true"==t.hasIcon}l(),t.closeFunc||(e.closeFunc=function(){e.defaultclose=!0});var o=angular.isDefined(t.type)?a(t.type)(e.$parent):null;if(e.hasIcon)switch(o){case"danger":e.iconClass="remove-sign";break;case"success":e.iconClass="ok-sign";break;case"info":e.iconClass="info-sign";break;default:e.iconClass="exclamation-sign"}var r=angular.isDefined(t.dismissOnTimeout)?a(t.dismissOnTimeout)(e.$parent):null;r&&n(function(){e.closeFunc()},parseInt(r,10))}]).directive("fuguAlert",function(){return{restrict:"E",templateUrl:function(e,t){return t.templateUrl||"templates/alert.html"},replace:!0,transclude:!0,scope:{type:"@",close:"@",closeFunc:"&",closeText:"@"},controller:"fuguAlertCtrl",controllerAs:"alert"}}),angular.module("ui.fugu.button",[]).constant("buttonConfig",{}).directive("fuguButton",[function(){return{restrict:"AE",scope:{disabled:"=?",loading:"=?",onClick:"&?click"},replace:!1,templateUrl:"templates/button.html",controller:"buttonController",link:function(e,t,n){function a(t,n){var a=e.$parent.$eval(t);return angular.isDefined(a)?a:t?t:n}t=angular.element(t.children()[0]);var l=a(n.btnclass,"default"),o=a(n.size,"default"),r=a(n.block,!1),i=a(n.active,!1),c=a(n.type,"button"),s=a(n.text,"button"),u=a(n.icon,"");switch(e.text=e.initText=s,e.type=c,e.icon="glyphicon-"+u,e.iconFlag=""!==u?!0:!1,e.disabled=e.initDisabled=angular.isDefined(e.disabled)?e.disabled:!1,e.loading=angular.isDefined(e.loading)?e.loading:!1,t.addClass("btn-"+l),o){case"large":o="lg";break;case"small":o="sm";break;case"x-small":o="xs";break;default:o="default"}t.addClass("btn-"+o),r&&t.addClass("btn-block"),i&&t.addClass("active"),e.$watch("disabled",function(e){e?t.attr("disabled","disabled"):t.removeAttr("disabled")}),t.bind("click",function(){e.onClick&&(e.onClick(),e.$parent.$apply())}),e.$watch("loading",function(n){var a=t.children("span.glyphicon-refresh-animate"),l=null;n?(e.disabled=n,a.length>0?a.removeClass("hidden"):(e.text="isLoading...",l='<span class="glyphicon glyphicon-refresh glyphicon-refresh-animate"></span>',t.prepend(l))):(e.disabled=e.initDisabled,e.text=e.initText,a.length>0&&a.addClass("hidden"))})}}}]).controller("buttonController",["$scope",function(e){e.btnClassArr=["default","primary","success","info","warning","danger","link"],e.sizeArr=["large","small","x-small","default"],e.typeArr=["button","reset","submit"]}]),angular.module("ui.fugu.buttonGroup",[]).constant("buttonGroupConfig",{size:"default",type:"radio",showClass:"default",checkboxTrue:!0,checkboxFalse:!1,disabled:!1}).controller("buttonGroupController",["$transclude","$scope","$element","$attrs","buttonGroupConfig",function(e,t,n,a,l){function o(e,n){var a=t.$parent.$eval(e);return angular.isDefined(a)?a:e?e:n}for(var r,i=e(),c=0,s=[],u={};c<i.length;c++)r=i[c].tagName,r&&"button"===r.toLocaleLowerCase()&&(u={},u.value=i[c].innerText,u.btnRadio=o(angular.element(i[c]).attr("btn-radio"),""),u.btnCheckbox=o(angular.element(i[c]).attr("btn-checkbox"),""),s.push(u));switch(t.buttons=s,t.type=o(a.type,l.type),t.size=o(a.size,l.size),t.showClass=o(a.showClass,l.showClass),t.checkboxTrue=o(a.checkboxTrue,l.checkboxTrue),t.checkboxFalse=o(a.checkboxFalse,l.checkboxFalse),t.disabled=o(a.disabled,l.disabled),t.size){case"large":t.size="btn-lg";break;case"small":t.size="btn-sm";break;case"x-small":t.size="btn-xs";break;default:t.size="btn-default"}t.showClass="btn-"+t.showClass,t.disabled&&(t.disabled="disabled")}]).directive("fuguButtonGroup",[function(){return{restrict:"AE",replace:!0,scope:{ngModel:"@"},require:"^ngModel",templateUrl:"templates/buttonGroup.html",transclude:!0,controller:"buttonGroupController",link:function(e,t,n,a){var l=e;e.modelObj=angular.copy(e.$parent.$eval(e.ngModel)),"radio"===e.type?(a.$render=function(){angular.forEach(e.buttons,function(e){angular.equals(a.$modelValue,e.btnRadio)?e.active="active":e.active=""})},e.clickFn=function(e,t){t.stopPropagation(),t.preventDefault(),l.disabled||(a.$setViewValue(e.btnRadio),a.$render())}):(a.$render=function(){angular.forEach(e.buttons,function(t){angular.equals(e.modelObj[t.btnCheckbox],e.checkboxTrue)?t.active="active":t.active=""})},e.clickFn=function(t,n){n.stopPropagation(),n.preventDefault(),l.disabled||(t.active?e.modelObj[t.btnCheckbox]=l.checkboxFalse:e.modelObj[t.btnCheckbox]=l.checkboxTrue,a.$setViewValue(e.modelObj),a.$render())})}}}]),angular.module("ui.fugu.dropdown",[]).constant("fuguDropdownConfig",{eachItemWidth:120,openClass:"open",multiColClass:"fugu-dropdown"}).provider("fuguDropdown",function(){var e=3;this.setColsNum=function(t){e=t||3},this.$get=function(){return{getColsNum:function(){return e}}}}).service("fuguDropdownService",["$document",function(e){function t(e){if(n){var t=n.getToggleElement();e&&t&&t[0].contains(e.target)||(n.isOpen=!1,n.$apply())}}var n=null;this.open=function(a){n||e.on("click",t),n&&n!==a&&(n.isOpen=!1),n=a},this.close=function(a){n===a&&(n=null,e.off("click",t))}}]).controller("fuguDropdownCtrl",["$scope","$rootScope","$element","fuguDropdownConfig","fuguDropdownService","fuguDropdown",function(e,t,n,a,l,o){e.colsNum=o.getColsNum(),e.eachItemWidth=a.eachItemWidth,e.openClass=a.openClass,e.multiColClass=a.multiColClass;var r=this;e.toggleDropdown=function(t){t.preventDefault(),e.isDisabled||r.toggle()},this.toggle=function(t){var n=e.isOpen=arguments.length?!!t:!e.isOpen;return n},this.isOpen=function(){return e.isOpen},this.init=function(){e.isDisabled=e.isDisabled||!!n.attr("disabled")||n.hasClass("disabled")},e.$watch("isOpen",function(t){t?l.open(e):l.close(e)}),e.getToggleElement=function(){return n.find(".dropdown-toggle")},e.count=0,this.addChild=function(){e.count++,e.count>e.colsNum&&n.find(".dropdown-menu > li").css("width",100/e.colsNum+"%")},e.$on("$locationChangeSuccess",function(){e.isOpen=!1})}]).directive("fuguDropdown",function(){return{restrict:"E",templateUrl:"templates/dropdown.html",replace:!0,require:"^fuguDropdown",transclude:!0,scope:{isOpen:"=?",isDisabled:"=?ngDisabled",btnValue:"@?"},controller:"fuguDropdownCtrl",link:function(e,t,n,a){a.init()}}}).directive("fuguDropdownChoices",function(){return{restrict:"E",templateUrl:"templates/dropdown-choices.html",require:"^fuguDropdown",replace:!0,transclude:!0,scope:!0,link:function(e,t,n,a){a.addChild()}}}),angular.module("ui.fugu.pager",[]).constant("fuguPagerConfig",{itemsPerPage:20,maxSize:5,firstText:"首页",lastText:"尾页",previousText:"上一页",nextText:"下一页"}).controller("fuguPagerCtrl",["$scope",function(e){function t(t){var n=Math.min(t-Math.floor(e.maxSize/2),e.totalPages-e.maxSize);return(0>n||isNaN(n))&&(n=0),n}function n(){e.pages=[];var t,n=Math.min(a+e.maxSize,e.totalPages);for(t=a;n>t;t++)e.pages.push({text:t,pageIndex:t,active:!1})}var a=0,l=!1;this.init=function(t){e.itemsPerPage=e.itemsPerPage||t.itemsPerPage,e.maxSize=e.maxSize||t.maxSize,e.getText=function(n){return e[n+"Text"]||t[n+"Text"]}},e.pages=[],e.currentPage=0,e.totalPages=1,e.$watch("pageNo",function(t){e.selectPage(t-1||0)}),e.$watch("totalItems",function(t){-1!==e.currentPage&&(e.totalPages=Math.ceil(t/e.itemsPerPage),(e.totalPages<=0||isNaN(e.totalPages))&&(e.totalPages=1),l&&a>e.totalPages&&(a=0,(e.currentPage<a||e.currentPage>=a+e.pages.length)&&(e.currentPage=0)),n(),l=!0,e.pages[e.currentPage-a]&&(e.pages[e.currentPage-a].active=!0),e.selectPage(e.currentPage))}),e.isFirst=function(){return e.currentPage<=0},e.isLast=function(){return e.currentPage>=e.totalPages-1},e.selectPage=function(l){if(!(l>=e.totalPages||0>l)){e.pages[e.currentPage-a]&&(e.pages[e.currentPage-a].active=!1);var o=t(l),r=e.currentPage;o!=a&&(a=o,n()),e.currentPage=l,e.pageNo=l+1,e.pages[e.currentPage-a]&&(e.pages[e.currentPage-a].active=!0);var i;angular.isDefined(e.pageChanged)&&r!==e.currentPage&&(i=e.pageChanged(),i&&"function"==typeof i&&i(e.currentPage+1))}},e.first=function(){e.isFirst()||this.selectPage(0)},e.last=function(){e.isLast()||this.selectPage(e.totalPages-1)},e.previous=function(){e.isFirst()||this.selectPage(e.currentPage-1)},e.next=function(){e.isLast()||this.selectPage(e.currentPage+1)}}]).directive("fuguPager",["fuguPagerConfig",function(e){return{restrict:"E",templateUrl:"templates/pager.html",replace:!0,require:"fuguPager",scope:{itemsPerPage:"=?",totalItems:"=",pageNo:"=",maxSize:"=?",firstText:"@?",lastText:"@?",previousText:"@?",nextText:"@?",pageChanged:"&?"},controller:"fuguPagerCtrl",link:function(t,n,a,l){l.init(e)}}}]),angular.module("ui.fugu.searchBox",[]).constant("fuguSearchBoxConfig",{btnText:"搜索",showBtn:!0}).controller("fuguSearchBoxCtrl",["$scope","$attrs","fuguSearchBoxConfig",function(e,t,n){var a={$setViewValue:angular.noop};e.searchBox={},this.init=function(l){l&&(a=l),a.$render=this.render,e.showBtn=angular.isDefined(t.showBtn)?e.$parent.$eval(t.showBtn):n.showBtn};var l;e.getText=function(){return l?l:l=angular.isDefined(t.btnText)?t.btnText:n.btnText},e.$watch("searchBox.query",function(e){a.$setViewValue(e),a.$render()}),e.keyUpToSearch=function(t){t&&13===t.keyCode&&(t.preventDefault(),t.stopPropagation(),e.doSearch())},e.doSearch=function(){angular.isDefined(e.search)&&"function"==typeof e.search&&e.search()},this.render=function(){a.$viewValue&&(e.searchBox.query=a.$viewValue)}}]).directive("fuguSearchBox",function(){return{restrict:"E",templateUrl:"templates/searchBox.html",replace:!0,require:["fuguSearchBox","?ngModel"],scope:{btnText:"@?",showBtn:"=?",placeholder:"@?",search:"&?"},controller:"fuguSearchBoxCtrl",link:function(e,t,n,a){var l=a[0],o=a[1];l.init(o)}}}),function(){"use strict";angular.module("ngCheckboxTree",[]).directive("ngCheckboxTree",function(){return{name:"tuSimpleTree",scope:{treeData:"=",treeSelected:"="},require:"?^ngModel",restrict:"E",replace:"true",template:'<div class="ng-checkbox-tree"></div>',transclude:!1,link:function(e,t,n){function a(e,t){var n=null,l=null,o=0;if(e.length>0)for(n=t.append("<ul></ul>").children("ul"),o=0;o<e.length;o++)l=n.append('<li><input type="checkbox" value='+e[o].id+"/>"+e[o].title+"</li>").children("li:eq("+o+")"),a(e[o].nodes,l)}function l(){var e=null,t=null;i.find("li").each(function(){e=angular.element(this),t=0===e.children("ul").length,t||e.children("input").remove()})}function o(e){e.empty()}function r(t){function a(){function e(t){var n=!0,a=null,l=null;t.each(function(){angular.element(this).children("input").is(":checked")||(n=!1)}),n&&(a=t.parent().parent(),l=t.parent().parent().parent().children("li"),a.length>0&&(a.children("input").prop("checked",!0),e(l)))}function n(e){var t=e.parent().parent(),a=e.parent().parent().parent().children("li");t.length>0&&(t.children("input").prop("checked",!1),n(a))}t.is(":checked")?(r.each(function(){angular.element(this).prop("checked",!0)}),e(o)):(r.each(function(){angular.element(this).prop("checked",!1)}),n(o))}var l=t.parent().parent(),o=l.children("li"),r=t.parent().find("input");"on"===n.treeLinkage&&a();var c=i.find("input");e.treeSelected=[],c.each(function(){angular.element(this).is(":checked")&&e.treeSelected.push(angular.element(this).val())}),e.$apply()}var i=angular.element(t);e.$watch("treeData",function(){o(i),a(e.treeData,i),"on"===n.leafOnly&&l(),i.find("input").bind("change",function(){r(angular.element(this))})},!0)}}})}(),angular.module("ui.fugu.tree",[]).constant("treeConfig",{treeClass:"fugu-tree",nodeClass:"fugu-tree-node",defaultCollapsed:!1}).directive("tree",["treeConfig","$parse",function(e,t){return{restrict:"AE",scope:!0,replace:!0,templateUrl:"template/tree.html",controller:"treeController",link:function(e,n,a){e.node=t(a.nodes)(e)}}}]).controller("treeController",["$scope","$element",function(e,t){var n=e;e.collapsed=!1,e.selected=!1,e.$on("clickFn",function(t,n){e.collapsed=n}),e.inputs=t.find("input"),e.$on("click-parent",function(e,t){n.clickNode=t})}]).controller("treeNodeController",["$scope","$element",function(e,t){e.$on("checked-change-child",function(e,t){e.currentScope.selected=t,e.currentScope.ele.find("input")[0].checked=t}),e.$on("checked-change-parent",function(e,t){var n=e.currentScope.ele,a=e.currentScope,l=n.find("input"),o=!0,r=null;if("undefined"!=typeof a.selected){for(r=1;r<l.length;r++)l[r].checked!==t&&(o=!1);t?o&&(e.currentScope.selected=t,l[0].checked=t):(e.currentScope.selected=t,l[0].checked=t)}}),e.ele=t,e.selected=!1,e.clickFn=function(t){e.$emit("click-parent",t),t.node.nodes&&t.node.nodes.length>0&&(e.collapsed=!e.collapsed)},e.add=function(e,t){var n={text:t.node.text+".1",nodes:[]};t.node.nodes&&t.node.nodes.push(n),t.node.nodes||(t.node.nodes=[n]),e.stopPropagation()},e["delete"]=function(e,n){t.empty(),n.node=null,e.stopPropagation()},e.checkFn=function(t){e.$broadcast("checked-change-child",t),e.$emit("checked-change-parent",t)},e.preventClick=function(e){e.stopPropagation()}}]).directive("treeNode",["treeConfig","$parse","$compile",function(e,t,n){return{restrict:"AE",scope:!0,replace:!0,require:["?^ngModel","^tree"],controller:"treeNodeController",templateUrl:"template/tree-node.html",link:function(e,a,l,o){var r=t(l.nodes)(e),i=o[0],c="",s="";e.node=r,i&&(c='<li ng-repeat="node in  node.nodes"><tree-node nodes="node"></tree-node><ol></ol></li>',s=n(c)(e),a.find("ol").append(s))}}}]),angular.module("alert/templates/alert.html",[]).run(["$templateCache",function(e){e.put("templates/alert.html",'<div ng-show="!defaultclose" class="alert fugu-alert" ng-class="[\'alert-\' + (type || \'warning\'), closeable ? \'alert-dismissible\' : null]" role="alert">    <div ng-show="hasIcon" class="alert-icon">        <span class="alert-icon-span glyphicon" ng-class="\'glyphicon-\'+iconClass"></span>    </div>    <button ng-show="closeable" type="button" class="close" ng-click="closeFunc({$event: $event})">        <span ng-if="!closeText">&times;</span>        <span class="cancel-text" ng-if="closeText">{{closeText}}</span>    </button>    <div ng-class="[hasIcon?\'show-icon\' : null]" ng-transclude></div></div>')}]),angular.module("button/templates/button.html",[]).run(["$templateCache",function(e){e.put("templates/button.html",'<button class="btn" type="{{type}}" ng-class="{\'btn-addon\': iconFlag}"><i class="glyphicon" ng-class="icon" ng-show="iconFlag"></i>{{text}}</button>')}]),angular.module("dropdown/templates/dropdown-choices.html",[]).run(["$templateCache",function(e){e.put("templates/dropdown-choices.html",'<li>    <a href="javascript:;" ng-transclude></a></li>')}]),angular.module("dropdown/templates/dropdown.html",[]).run(["$templateCache",function(e){e.put("templates/dropdown.html",'<div class="btn-group dropdown" ng-class="[{true:multiColClass}[count>colsNum],{true:openClass}[isOpen]]">    <button type="button" ng-click="toggleDropdown($event)" ng-disabled="isDisabled" class="btn btn-sm btn-primary dropdown-toggle">        {{btnValue}}&nbsp;<span class="caret"></span>    </button>    <ul class="dropdown-menu" ng-style="{width:count>colsNum?colsNum*eachItemWidth:\'auto\'}" ng-transclude></ul></div>')}]),angular.module("pager/templates/pager.html",[]).run(["$templateCache",function(e){e.put("templates/pager.html",'<ul class="pagination pagination-sm m-t-none m-b-none">    <li ng-class="{disabled: isFirst()}">        <a href="javascript:void(0)" ng-click="first()">{{getText(\'first\')}}</a>    </li>    <li ng-class="{disabled: isFirst()}">        <a href="javascript:void(0)" ng-click="previous()">{{getText(\'previous\')}}</a>    </li>    <li ng-repeat="page in pages track by $index" ng-class="{active: page.active}">        <a href="javascript:void(0)" ng-click="selectPage(page.pageIndex)">{{page.pageIndex + 1}}</a>    </li>    <li ng-class="{disabled: isLast()}">        <a href="javascript:void(0)" ng-click="next()">{{getText(\'next\')}}</a>    </li>    <li ng-class="{disabled: isLast()}">        <a href="javascript:void(0)" ng-click="last()">{{getText(\'last\')}}</a>    </li>    <li class="disabled">        <a href="javascript:void(0)">共{{totalPages}}页 / {{totalItems}}条</a>    </li></ul>')}]),angular.module("buttonGroup/templates/buttonGroup.html",[]).run(["$templateCache",function(e){e.put("templates/buttonGroup.html",'<div class="btn-group">    <label class="btn  btn-default"  ng-class="[showClass, size, disabled, btn.active]" ng-repeat="btn in buttons" ng-click="clickFn(btn, $event)">{{btn.value}}</label></div>')}]),angular.module("searchBox/templates/searchBox.html",[]).run(["$templateCache",function(e){e.put("templates/searchBox.html",'<div ng-class="{\'input-group\':showBtn}">    <input type="text" class="input-sm form-control" ng-keyup="keyUpToSearch($event)" placeholder="{{placeholder}}" ng-model="searchBox.query">    <span class="input-group-btn" ng-if="showBtn">        <button class="btn btn-sm btn-default" type="button" ng-click="doSearch()">{{getText()}}</button>    </span></div>')}]);


